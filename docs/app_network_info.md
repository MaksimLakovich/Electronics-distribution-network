# üåê –¢–æ—Ä–≥–æ–≤–∞—è —Å–µ—Ç—å

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `network` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–µ–Ω—å—è–º–∏ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∏ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤.

---

## üß± –ú–æ–¥–µ–ª–∏ –≤ network/models.py

### 1. –ú–æ–¥–µ–ª—å AddressNode(TimeStampedModel)

| –ü–æ–ª–µ               | –¢–∏–ø              | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                            |
|-------------------|-----------------|---------------------------------------------------------------------------------------------------------------------|
| `country`          | CharField        | –°—Ç—Ä–∞–Ω–∞                                                                                                              |
| `city`             | CharField        | –ì–æ—Ä–æ–¥                                                                                                               |
| `street`           | CharField        | –£–ª–∏—Ü–∞                                                                                                               |
| `house_number`     | CharField        | –î–æ–º                                                                                                                 |
| `created_at`       | DateTimeField    | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è                                                                                       |
| `updated_at`       | DateTimeField    | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–∏—è                                                                                      |

### 2. –ú–æ–¥–µ–ª—å NetworkNode(TimeStampedModel)

| –ü–æ–ª–µ               | –¢–∏–ø              | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                            |
|--------------------|-----------------|---------------------------------------------------------------------------------------------------------------------|
| `name`             | CharField        | –ù–∞–∑–≤–∞–Ω–∏–µ –∑–≤–µ–Ω–∞ —Å–µ—Ç–∏                                                                                                 |
| `email`            | EmailField       | Email –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞/–æ—Ñ–∏—Å–∞                                                                                        |
| `address`          | ForeignKey       | –ê–¥—Ä–µ—Å—Å, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –¥–∞–Ω–Ω—ã–º –∑–≤–µ–Ω–æ–º                                                                                   |
| `product`          | ForeignKey       | –ü—Ä–æ–¥—É–∫—Ç, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –¥–∞–Ω–Ω—ã–º –∑–≤–µ–Ω–æ–º                                                                                  |
| `parent`           | ForeignKey       | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –∑–≤–µ–Ω–æ (–ø–æ—Å—Ç–∞–≤—â–∏–∫). –°—Å—ã–ª–∫–∞ –Ω–∞ –¥—Ä—É–≥–æ–µ –∑–≤–µ–Ω–æ —Å–µ—Ç–∏                                                         |
| `level`            | PositiveSmallIntegerField | –£—Ä–æ–≤–µ–Ω—å –∏–µ—Ä–∞—Ä—Ö–∏–∏ (0 - –∑–∞–≤–æ–¥, 1 - —Ä–æ–∑–Ω–∏—á–Ω–∞—è —Å–µ—Ç—å, 2 - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å). –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. |
| `debt_to_supplier` | DecimalField     | –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º                                                                                     |
| `created_at`       | DateTimeField    | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è                                                                                       |
| `updated_at`       | DateTimeField    | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–∏—è                                                                                      |

> ‚ö†Ô∏è 
> 1. –í–∞–ª–∏–¥–∞—Ü–∏—è (network/validators.py): `NetworkLevelValidator` –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∑–≤–µ–Ω–∞ —Å —É—Ä–æ–≤–Ω–µ–º –≤—ã—à–µ 2.  
> 2. –í –º–æ–¥–µ–ª–∏ –º–µ—Ç–æ–¥ `save()` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç: 
>    - **validate_no_cycles_in_level()** - –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–∏–∫–ª—ã –¥–ª—è –ø–æ–ª—è `level`.
>    - **validate_level()** - –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç level –∏–µ—Ä–∞—Ä—Ö–∏–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–∞.
>    - **calculate_level()** - –º–µ—Ç–æ–¥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç level.

---

## üñ• –ê–¥–º–∏–Ω–∫–∏ –≤ network/admin.py

###  1. AddressNodeAdmin(admin.ModelAdmin)

–í –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã:
- –ø–æ–ª—è: "id", "country", "city", "street", "house_number", "updated_at"
- —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ "country", "city", "street"

###  2. –ê–¥–º–∏–Ω–∫–∞ NetworkNodeAdmin(admin.ModelAdmin)

–í –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã:
- –ø–æ–ª—è: "id", "name", "level", "address_link", "product_link", "parent_link", "debt_to_supplier", "updated_at"
- —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ "address__city"
- –ø–æ–∏—Å–∫ –ø–æ "name", "address__city", "product__name"
- –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ (`product_link`, `parent_link`, `address_link`)
- **Admin action**: –æ—á–∏—â–µ–Ω–∏–µ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (`clear_debt`)

> –ü–æ–ª—è `level`, `created_at`, `updated_at` —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è, –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é.

---

## üîí –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

1. –î–æ—Å—Ç—É–ø –∫ API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–º –∫–ª–∞—Å—Å–æ–º `users.permissions.IsActiveEmployee`  

2. –£—Å–ª–æ–≤–∏—è –¥–æ–ø—É—Å–∫–∞:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
   - is_active=True
   - –°–æ—Å—Ç–æ–∏—Ç –≤ –≥—Ä—É–ø–ø–µ "Employees"

3. –ì—Ä—É–ø–ø–∞ *Employee* —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–µ–π:
   - users/migrations/0002_create_employee_group.py

---

## ‚öôÔ∏è API (—á–µ—Ä–µ–∑ Django REST Framework)

| –ú–µ—Ç–æ–¥  | –≠–Ω–¥–ø–æ–∏–Ω—Ç                            | –û–ø–∏—Å–∞–Ω–∏–µ                                                                    | –î–æ—Å—Ç—É–ø               |
| ------ | ---------------------------------- |-----------------------------------------------------------------------------| -------------------- |
| GET    | `/api/network-node/`               | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –∑–≤–µ–Ω—å–µ–≤                                                | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| GET    | `/api/network-node/?country=Japan` | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –∑–≤–µ–Ω—å–µ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Å—Ç—Ä–∞–Ω–µ                        | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| POST   | `/api/network-node/`               | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–≤–µ–Ω–∞ —Å–µ—Ç–∏                                                  | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| GET    | `/api/network-node/<int:pk>/`     | –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–¥–Ω–æ–≥–æ –∑–≤–µ–Ω–∞                                                       | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| PUT    | `/api/network-node/<int:pk>/`     | –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–≤–µ–Ω–∞                                                     | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| PATCH  | `/api/network-node/<int:pk>/`     | –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–≤–µ–Ω–∞                                                  | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| DELETE | `/api/network-node/<int:pk>/`     | –£–¥–∞–ª–µ–Ω–∏–µ –∑–≤–µ–Ω–∞                                                              | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| GET    | `/api/address/`               | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –∞–¥—Ä–µ—Å–æ–≤                                                | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| GET    | `/api/address/?country=–†–æ—Å—Å–∏—è&city=–ú–æ—Å–∫–≤–∞&street=–ú–∏—Ä–∞` | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –∑–≤–µ–Ω—å–µ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ 3 –ø–æ–ª—è–º: —Å—Ç—Ä–∞–Ω–∞, –≥–æ—Ä–æ–¥, —É–ª–∏—Ü–∞ | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| POST   | `/api/address/`               | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞                                                      | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| GET    | `/api/address/<int:pk>/`     | –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–¥–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞                                                       | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| PUT    | `/api/address/<int:pk>/`     | –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞                                                     | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| PATCH  | `/api/address/<int:pk>/`     | –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞                                                  | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |
| DELETE | `/api/address/<int:pk>/`     | –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞                                                              | üë§ –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ |

> ‚ö†Ô∏è –î–ª—è —É–¥–æ–±–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ–ª—é **"–°—Ç—Ä–∞–Ω–∞"** –≤ –∑–≤–µ–Ω—å—è—Ö —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏ —Å–æ–∑–¥–∞–Ω alias (filterset_class = NetworkNodeFilter) 
> –≤ –º–æ–¥—É–ª–µ `network/filters.py`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É–¥–æ–±–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `?country=` 
> (–Ω–∞–ø—Ä–∏–º–µ—Ä, "/api/network-node/?country=–ö–æ—Ä–µ—è"), –≤–º–µ—Å—Ç–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ `?address__country=`

---

## üß© ViewSet –∏ Generics

1. ***NetworkNodeViewSet(viewsets.ModelViewSet)*** —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π CRUD –¥–ª—è –º–æ–¥–µ–ª–∏ `NetworkNode`:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç `level` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–¥–∏—Ç–µ–ª—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è —á–µ—Ä–µ–∑ `NetworkLevelValidator` (–Ω–µ –±–æ–ª–µ–µ 2).
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–µ (`country`).

2. ***AddressNodeListCreateAPIView(generics.ListCreateAPIView)*** –∏ ***AddressNodeRetrieveUpdateDestroyAPIView(generics.RetrieveUpdateDestroyAPIView)*** —Ä–µ–∞–ª–∏–∑—É—é—Ç –ø–æ–ª–Ω—ã–π CRUD –¥–ª—è –º–æ–¥–µ–ª–∏ `AddressNode`:
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–µ (`country`, `city`, `street`).

---

## üß± Serializer

1. `AddressNodeSerializer(serializers.ModelSerializer)`:
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤—Å–µ—Ö –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏.


2. `NetworkNodeSerializer(serializers.ModelSerializer)`:
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤—Å–µ—Ö –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏.
   - `parent` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è —á–µ—Ä–µ–∑ `NetworkLevelValidator`.
   - `debt_to_supplier` –ø–æ–ª–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è (–∑–∞–ø—Ä–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ API).

---

## üìå –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏–µ—Ä–∞—Ä—Ö–∏–∏

- –ò–µ—Ä–∞—Ä—Ö–∏—è —Å—Ç—Ä–æ–≥–æ —Ç—Ä–µ—Ö —É—Ä–æ–≤–Ω–µ–π:
  - 0 - –∑–∞–≤–æ–¥
  - 1 - —Ä–æ–∑–Ω–∏—á–Ω–∞—è —Å–µ—Ç—å
  - 2 - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å
- –£—Ä–æ–≤–µ–Ω—å (`level`) **–Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é**.
- –õ—é–±–æ–µ –∑–≤–µ–Ω–æ –≤—Å–µ–≥–¥–∞ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è (`parent`) - –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞.
- –ó–∞–ø—Ä–µ—â–µ–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–≤–µ–Ω–æ —Å —É—Ä–æ–≤–Ω–µ–º –≤—ã—à–µ 2 (–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –∏ –≤ –∞–¥–º–∏–Ω–∫–µ, –∏ —á–µ—Ä–µ–∑ API).
